package bindata_files

import (
	"path/filepath"
	"time"

	"ktkr.us/pkg/vfs/bindata"
)

func init() {
	bindata.RegisterFile(filepath.Join("static", "key.pls.js"), time.Unix(1443996787, 0), []byte("function Key(delegate) {\n\x09this.delegate = delegate;\n\n\x09this.handlers = {\n\x09\x09'space': function() {\n\x09\x09\x09if (this.delegate.currentSong != null) {\n\x09\x09\x09\x09this.delegate.currentSong.toggle();\n\x09\x09\x09}\n\x09\x09},\n\x09\x09'left': this.prevSong,\n\x09\x09'up': this.prevSong,\n\x09\x09'right': this.nextSong,\n\x09\x09'down': this.nextSong,\n\x09\x09'0': this.seekBeginning,\n\x09\x09'^': this.seekBeginning,\n\x09\x09'd': function() {\n\x09\x09\x09if (this.delegate.currentSong != null) {\n\x09\x09\x09\x09this.delegate.currentSong.scrollTo();\n\x09\x09\x09\x09this.delegate.currentSong.remove();\n\x09\x09\x09}\n\x09\x09},\n\x09\x09'G': function() {\n\x09\x09\x09var song = $('#songlist').lastElementChild;\n\x09\x09\x09if (song != null) {\n\x09\x09\x09\x09song.scrollTo();\n\x09\x09\x09\x09song.play();\n\x09\x09\x09}\n\x09\x09},\n\x09\x09'g': function() {\n\x09\x09\x09var song = $('#songlist').firstElementChild;\n\x09\x09\x09if (song != null) {\n\x09\x09\x09\x09song.scrollTo();\n\x09\x09\x09\x09song.play();\n\x09\x09\x09}\n\x09\x09},\n\x09\x09'h': function() {\n\x09\x09\x09if (this.delegate.currentSong != null) {\n\x09\x09\x09\x09var a = this.delegate.currentSong.audio;\n\x09\x09\x09\x09if (a.duration > 5) {\n\x09\x09\x09\x09\x09a.currentTime -= 5;\n\x09\x09\x09\x09} else {\n\x09\x09\x09\x09\x09a.currentTime = 0;\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\x09\x09},\n\x09\x09'j': this.nextSong,\n\x09\x09'k': this.prevSong,\n\x09\x09'l': function() {\n\x09\x09\x09if (this.delegate.currentSong != null) {\n\x09\x09\x09\x09var a = this.delegate.currentSong.audio;\n\x09\x09\x09\x09if (a.duration - a.currentTime > 5) {\n\x09\x09\x09\x09\x09a.currentTime += 5;\n\x09\x09\x09\x09} else {\n\x09\x09\x09\x09\x09a.currentTime = a.duration;\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\x09\x09},\n\x09\x09'?': function() {\n\x09\x09\x09var songs = $('#songlist').querySelectorAll('li.song');\n\x09\x09\x09var song = this.delegate.currentSong;\n\n\x09\x09\x09while (song == null || song == this.delegate.currentSong) {\n\x09\x09\x09\x09var i = Math.floor(Math.random() * songs.length);\n\x09\x09\x09\x09song = songs[i];\n\x09\x09\x09}\n\n\x09\x09\x09song.scrollTo();\n\x09\x09\x09song.play();\n\x09\x09},\n\x09\x09'`': function() {\n\x09\x09\x09if (this.delegate.currentSong != null) {\n\x09\x09\x09\x09this.delegate.currentSong.scrollTo(); \n\x09\x09\x09}\n\x09\x09}\n\x09};\n\n\x09window.addEventListener('keydown', function(e) {\n\x09\x09var group = Key.table[e.which];\n\x09\x09if (group == null) {\n\x09\x09\x09return;\n\x09\x09}\n\x09\x09var target;\n\x09\x09if (e.shiftKey) {\n\x09\x09\x09if (group.length >= 2) {\n\x09\x09\x09\x09target = group[1];\n\x09\x09\x09} else {\n\x09\x09\x09\x09target = group[0].toUpperCase();\n\x09\x09\x09}\n\x09\x09} else {\n\x09\x09\x09target = group[0];\n\x09\x09}\n\x09\x09if (e.ctrlKey) {\n\x09\x09\x09target = 'C-' + target;\n\x09\x09}\n\x09\x09if (e.metaKey || e.altKey) {\n\x09\x09\x09target = 'M-' + target;\n\x09\x09}\n\x09\x09var handler = this.handlers[target];\n\x09\x09if (handler != null) {\n\x09\x09\x09e.preventDefault();\n\x09\x09\x09e.stopPropagation();\n\x09\x09\x09handler.call(this, e);\n\x09\x09}\n\x09}.bind(this), false);\n};\n\nKey.prototype.prevSong = function() {\n\x09if (this.delegate.currentSong == null) { return; }\n\n\x09this.delegate.currentSong.prev();\n\n\x09if (this.delegate.currentSong.offsetTop < window.scrollY) {\n\x09\x09this.delegate.currentSong.scrollTo();\n\x09}\n};\n\nKey.prototype.nextSong = function() {\n\x09if (this.delegate.currentSong == null) { return; }\n\n\x09this.delegate.currentSong.next();\n\n\x09var screenBottom = window.scrollY + window.innerHeight;\n\x09var songBottom = this.delegate.currentSong.offsetTop + this.delegate.currentSong.offsetHeight;\n\x09if ((songBottom + $('header').offsetHeight) > screenBottom) {\n\x09\x09this.delegate.currentSong.scrollToBottom();\n\x09}\n};\n\nKey.prototype.seekBeginning = function() {\n\x09if (this.delegate.currentSong != null) {\n\x09\x09this.delegate.currentSong.audio.currentTime = 0;\n\x09}\n};\n\n\nKey.table = {\n\x0932:   ['space'],\n\x0937:   ['left'],\n\x0938:   ['up'],\n\x0939:   ['right'],\n\x0940:   ['down'],\n\x0948:   ['0', ')'],\n\x0954:   ['6', '^'],\n\x0968:   ['d'],\n\x0971:   ['g'],\n\x0972:   ['h'],\n\x0974:   ['j'],\n\x0975:   ['k'],\n\x0976:   ['l'],\n\x09191:  ['/', '?'],\n\x09192:  ['`', '~']\n};\n"))
	bindata.RegisterFile(filepath.Join("static", "pls.js"), time.Unix(1473264073, 0), []byte("function $(sel) { return document.querySelector(sel); }\nfunction $$(sel) { return document.querySelectorAll(sel); }\n\nfunction percent(cur, max) {\n\x09return (cur/max)*100 + '%';\n}\n\nfunction formatDuration(n) {\n\x09var mins = Math.floor(n/60);\n\x09var secs = Math.round(n % 60);\n\x09if (secs == 60) {\n\x09\x09mins++;\n\x09\x09secs = 0;\n\x09}\n\x09if (secs <= 9) {\n\x09\x09secs = '0' + secs;\n\x09}\n\x09return mins + ':' + secs;\n}\n\n// Seems like Chrome has a non-standard \"items\" property of the FileTransfer\n// object which already contains MIME types when a dragenter occurs. We can use\n// this to try to give some negative feedback early.\nfunction isAudioFile(items) {\n\x09if (items == null) {\n\x09\x09return true;\n\x09}\n\x09for (var i = 0, item; item = items[i]; i++) {\n\x09\x09if (item.kind == 'file' && item.type.indexOf('audio/') == 0) {\n\x09\x09\x09return true;\n\x09\x09}\n\x09}\n\n\x09return false;\n}\n\nfunction getURLParams() {\n\x09var components = window.location.pathname.split('/');\n\x09var id = components[1];\n\x09var filename = components[2];\n\x09return { \"id\": id, \"filename\": filename };\n}\n\nfunction xhr(url, mutate, cb) {\n\x09var x = new XMLHttpRequest();\n\n\x09x.addEventListener('load', function(e) {\n\x09\x09cb(e.target);\n\x09}, false);\n\n\x09mutate(x);\n\n\x09x.open('GET', url);\n\x09x.send();\n}\n\nfunction json(url, cb) {\n\x09xhr(url, null, function(x) {\n\x09\x09var obj = {};\n\x09\x09try {\n\x09\x09\x09obj = JSON.parse(x.responseText);\n\x09\x09} catch (e) {\n\x09\x09\x09console.log(e);\n\x09\x09\x09return;\n\x09\x09}\n\x09\x09cb(obj);\n\x09});\n}\n\nfunction diff(a, b, cmp, add, rem) {\n\x09var addlist = [];\n\x09var remlist = [];\n\n\x09var ia = ib = 0;\n\x09var ja, jb, xa, xb;\n\n\x09for (;;) {\n\x09\x09xa = a[ia];\n\x09\x09xb = b[ib];\n\n\x09\x09if (!cmp(xa, xb)) {\n\x09\x09\x09var found = false;\n\n\x09\x09\x09// check if old has more\n\x09\x09\x09for (ja = ia; xa = a[ja]; ja++) {\n\x09\x09\x09\x09if (cmp(xa, xb)) {\n\x09\x09\x09\x09\x09found = true;\n\x09\x09\x09\x09\x09// old has more - should delete them\n\x09\x09\x09\x09\x09for (var i = ia; i < ja; i++) {\n\x09\x09\x09\x09\x09\x09remlist.push(a[i]);\n\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09\x09ia = ja;\n\x09\x09\x09\x09\x09break;\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\n\x09\x09\x09if (!found) {\n\x09\x09\x09\x09// check if new has more\n\x09\x09\x09\x09for (jb = ib; xb = b[jb]; jb++) {\n\x09\x09\x09\x09\x09if (cmp(xa, xb)) {\n\x09\x09\x09\x09\x09\x09found = true;\n\x09\x09\x09\x09\x09\x09for (var i = ib; i < jb; i++) {\n\x09\x09\x09\x09\x09\x09\x09addlist.push(b[i]);\n\x09\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09\x09\x09ib = jb;\n\x09\x09\x09\x09\x09\x09break;\n\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\n\x09\x09\x09if (!found) {\n\x09\x09\x09\x09// the new one is completely different; complete replacement\n\x09\x09\x09\x09remlist = a;\n\x09\x09\x09\x09addlist = b;\n\x09\x09\x09\x09break;\n\x09\x09\x09}\n\x09\x09}\n\x09}\n\n\x09remlist.forEach(rem);\n\x09addlist.forEach(add);\n}\n\nvar Pls = {\n\x09init: function(opts) {\n\x09\x09this.haveAudioAPI = false;\n\x09\x09var that = this;\n\n\x09\x09var cookies = document.cookie.split(';');\n\x09\x09window.cookies = {};\n\x09\x09for (var i = 0, cookie; cookie = cookies[i]; i++) {\n\x09\x09\x09var pair = cookie.split('=');\n\x09\x09\x09window.cookies[pair[0]] = pair[1];\n\x09\x09}\n\n\x09\x09window.addEventListener('DOMContentLoaded', function() {\n\x09\x09\x09this.shroud = $('#shroud');\n\x09\x09\x09this.follower = $('#follower');\n\x09\x09\x09if (window.Visual != null) {\n\x09\x09\x09\x09try {\n\x09\x09\x09\x09\x09this.ctx = new (window.AudioContext || window.webkitAudioContext)();\n\x09\x09\x09\x09\x09this.haveAudioAPI = true;\n\x09\x09\x09\x09\x09this.analyser = this.ctx.createAnalyser();\n\x09\x09\x09\x09\x09this.analyser.connect(this.ctx.destination);\n\x09\x09\x09\x09\x09this.vis = new Visual($('#vis'), this.analyser, 5, opts.vis.bars || 32);\n\x09\x09\x09\x09} catch (e) { \n\x09\x09\x09\x09\x09console.log(e);\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\n\x09\x09\x09var songs = $$('li.song');\n\x09\x09\x09for (var i = 0, song; song = songs[i]; i++) {\n\x09\x09\x09\x09this.hookSong(song);\n\x09\x09\x09}\n\n\x09\x09\x09this.hookFollower(this.follower);\n\n\x09\x09\x09/*\n\x09\x09\x09 * drag over -> show follower without loader bar\n\x09\x09\x09 * drag exit -> hide follower with animation\n\x09\x09\x09 * drop -> do upload -> hide follower with animation\n\x09\x09\x09 */\n\n\x09\x09\x09if (window.Key != null) {\n\x09\x09\x09\x09this.key = new Key(this);\n\x09\x09\x09}\n\n\x09\x09\x09this.form = $('#file-upload');\n\x09\x09\x09this.form.addEventListener('change', function() {\n\x09\x09\x09\x09if (this.files.length == 0 || this.files[0].type.indexOf('audio/') != 0) {\n\x09\x09\x09\x09\x09return;\n\x09\x09\x09\x09}\n\x09\x09\x09\x09this.style.visibility = 'hidden';\n\x09\x09\x09\x09this.style.display = 'block';\n\x09\x09\x09\x09that.follower.setPos(window.innerWidth/2, window.innerHeight/2);\n\x09\x09\x09\x09this.style.display = 'none';\n\x09\x09\x09\x09this.style.visibility = '';\n\x09\x09\x09\x09that.follower.show();\n\x09\x09\x09\x09that.upload(this.files[0]);\n\x09\x09\x09}, false);\n\n\x09\x09\x09$('#upload').addEventListener('click', function() {\n\x09\x09\x09\x09this.form.click();\n\x09\x09\x09}.bind(this), false);\n\n\x09\x09\x09document.body.addEventListener('dragenter',  this.dragenter.bind(this),  false);\n\x09\x09\x09this.shroud.addEventListener('dragover',     this.dragover.bind(this),   false);\n\x09\x09\x09this.shroud.addEventListener('dragleave',    this.dragleave.bind(this),  false);\n\x09\x09\x09this.shroud.addEventListener('drop',         this.drop.bind(this),       false);\n\n\x09\x09\x09window.addEventListener('popstate', function(e) {\n\x09\x09\x09\x09var id;\n\x09\x09\x09\x09if (e.state != null) {\n\x09\x09\x09\x09\x09id = e.state.id;\n\x09\x09\x09\x09} else {\n\x09\x09\x09\x09\x09if (window.location.pathname == '/') {\n\x09\x09\x09\x09\x09\x09if (this.currentSong != null) {\n\x09\x09\x09\x09\x09\x09\x09this.currentSong.stop();\n\x09\x09\x09\x09\x09\x09\x09this.currentSong.disable();\n\x09\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09\x09\x09return;\n\x09\x09\x09\x09\x09} else {\n\x09\x09\x09\x09\x09\x09id = getURLParams().id;\n\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09}\n\x09\x09\x09\x09this.playID(id);\n\x09\x09\x09}.bind(this), false);\n\n\x09\x09\x09if (window.location.pathname != \"/\") {\n\x09\x09\x09\x09var params = getURLParams();\n\x09\x09\x09\x09this.playID(params.id);\n\x09\x09\x09\x09history.replaceState(params, params.filename, window.location.pathname);\n\x09\x09\x09}\n\x09\x09}.bind(this));\n\x09},\n\n\x09dragenter: function(e) {\n\x09\x09if (!isAudioFile(e.dataTransfer.items)) {\n\x09\x09\x09e.dataTransfer.dropEffect = 'none';\n\x09\x09\x09return;\n\x09\x09}\n\x09\x09e.preventDefault();\n\x09\x09e.stopPropagation();\n\x09\x09this.follower.setPosEvent(e);\n\x09\x09this.shroud.classList.add('active');\n\x09\x09this.follower.show();\n\x09\x09e.dataTransfer.dropEffect = 'copy';\n\x09},\n\n\x09dragover: function(e) {\n\x09\x09e.preventDefault();\n\x09\x09e.stopPropagation();\n\x09\x09this.follower.setPosEvent(e);\n\x09\x09this.follower.show();\n\x09},\n\n\x09dragleave: function(e) {\n\x09\x09// get rid of thing\n\x09\x09e.preventDefault();\n\x09\x09e.stopPropagation();\n\x09\x09this.shroud.classList.remove('active');\n\x09\x09this.follower.hide();\n\x09},\n\n\x09drop: function(e) {\n\x09\x09e.preventDefault();\n\x09\x09e.stopPropagation();\n\x09\x09this.shroud.classList.remove('active');\n\n\x09\x09var files = e.dataTransfer.files;\n\x09\x09if (files.length == 0) {\n\x09\x09\x09this.follower.hide();\n\x09\x09\x09return;\n\x09\x09}\n\n\x09\x09// According to the standard FileTransfer object, this is the proper place\n\x09\x09// to check for file type\n\x09\x09if (files[0].type.indexOf('audio/') != 0) {\n\x09\x09\x09this.follower.hide();\n\x09\x09\x09return;\n\x09\x09}\n\n\x09\x09this.upload(files[0]);\n\x09},\n\n\x09playID: function(id) {\n\x09\x09var song = $('[data-id=\"' + id + '\"]');\n\x09\x09if (song != null) {\n\x09\x09\x09var secs;\n\x09\x09\x09var fragment = window.location.hash;\n\n\x09\x09\x09if (fragment != \"\") {\n\x09\x09\x09\x09var parts = fragment.slice(1).split(':');\n\x09\x09\x09\x09var mins = hrs = 0;\n\n\x09\x09\x09\x09if (parts.length >= 1) {\n\x09\x09\x09\x09\x09secs = parseInt(parts[parts.length-1]);\n\x09\x09\x09\x09\x09if (parts.length >= 2) {\n\x09\x09\x09\x09\x09\x09mins = parseInt(parts[parts.length-2]);\n\x09\x09\x09\x09\x09\x09if (parts.length >= 3) {\n\x09\x09\x09\x09\x09\x09\x09hrs = parseInt(parts[parts.length-3]);\n\x09\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09}\n\n\x09\x09\x09\x09if (isNaN(secs) || isNaN(mins)) {\n\x09\x09\x09\x09\x09return;\n\x09\x09\x09\x09}\n\n\x09\x09\x09\x09secs += mins*60;\n\x09\x09\x09\x09if (!isNaN(hrs)) {\n\x09\x09\x09\x09\x09secs += hrs*60*60;\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\x09\x09\x09song.scrollTo();\n\x09\x09\x09song.play(secs);\n\x09\x09}\n\x09},\n\n\x09upload: function(file) {\n\x09\x09var x = new XMLHttpRequest();\n\x09\x09this.loader.reset();\n\n\x09\x09x.upload.addEventListener('progress', function(e) {\n\x09\x09\x09if (e.lengthComputable) {\n\x09\x09\x09\x09this.loader.setProgress(e.loaded / e.total);\n\x09\x09\x09}\n\x09\x09}.bind(this), false);\n\n\x09\x09x.upload.addEventListener('load', function() {\n\x09\x09\x09this.loader.setProgress(1);\n\x09\x09}.bind(this), false);\n\n\x09\x09x.addEventListener('load', function(e) {\n\x09\x09\x09if (e.target.status !== 201) {\n\x09\x09\x09\x09var err = JSON.parse(e.target.responseText);\n\x09\x09\x09\x09this.showMessage($('#upload'), err.Error, 'bad');\n\x09\x09\x09} else {\n\x09\x09\x09\x09this.insertSong(e.target.response.querySelector('li.song'));\n\x09\x09\x09}\n\x09\x09\x09this.follower.hide();\n\x09\x09}.bind(this), false);\n\n\x09\x09x.addEventListener('cancel', function() {\n\x09\x09\x09this.follower.hide();\n\x09\x09}.bind(this), false);\n\n\x09\x09// TODO: cancel handler\n\x09\x09// TODO: put a cancel button in the middle of the loader\n\n\x09\x09x.responseType = 'document';\n\x09\x09x.open('POST', '/upload', true);\n\x09\x09x.setRequestHeader('X-Pls-Filename', encodeURIComponent(file.name));\n\x09\x09x.send(file);\n\x09},\n\n\x09insertSong: function(song) {\n\x09\x09if (song == null) {\n\x09\x09\x09return;\n\x09\x09}\n\x09\x09var songList = $('#songlist');\n\x09\x09songList.insertBefore(song, songList.firstElementChild);\n\x09\x09var trackCount = $('#track-count');\n\x09\x09trackCount.innerText = parseInt(trackCount.innerText) + 1;\n\x09\x09this.hookSong(song);\n\x09\x09song.classList.remove('fresh');\n\x09},\n\n\x09showMessage: function(source, msg, klass) {\n\x09\x09alert(msg);\n\x09},\n\n\x09clickOffset: function(e) {\n\x09\x09if (e.changedTouches != null && e.changedTouches.length >= 1) {\n\x09\x09\x09var t = e.changedTouches[0];\n\x09\x09\x09return t.clientX - t.target.clientLeft;\n\x09\x09}\n\x09\x09return e.offsetX;\n\x09},\n\n\x09hookAudio: function(audio) {\n\x09\x09var that = this;\n\n\x09\x09audio.track           = audio.parentElement.querySelector('.player-track');\n\x09\x09audio.track.audio     = audio;\n\x09\x09audio.track.bar       = audio.track.querySelector('.playback-bar');\n\x09\x09audio.track.bufferBar = audio.track.querySelector('.buffer-bar');\n\n\x09\x09var mousemove = function(e) {\n\x09\x09\x09if (e.buttons === 1 || e.type === 'touchmove') {\n\x09\x09\x09\x09e.stopPropagation();\n\x09\x09\x09\x09e.preventDefault();\n\x09\x09\x09\x09this.dragging = true;\n\x09\x09\x09\x09var offset = Pls.clickOffset(e);\n\x09\x09\x09\x09this.bar.style.width = percent(offset, this.offsetWidth);\n\x09\x09\x09\x09this.audio.song.currentTime.innerText = this.audio.song.currentTime.textContent = formatDuration(this.audio.duration * (offset/this.offsetWidth)) + '/';\n\x09\x09\x09}\n\x09\x09};\n\x09\x09var mouseup = function(e) {\n\x09\x09\x09e.preventDefault();\n\x09\x09\x09e.stopPropagation();\n\x09\x09\x09this.dragging = false;\n\x09\x09\x09this.audio.wasPaused = this.audio.paused;\n\x09\x09\x09var seek = function() {\n\x09\x09\x09\x09this.removeEventListener('seeked', seek);\n\x09\x09\x09\x09if (!this.wasPaused) {\n\x09\x09\x09\x09\x09this.play();\n\x09\x09\x09\x09}\n\x09\x09\x09};\n\x09\x09\x09this.audio.addEventListener('seeked', seek, false);\n\x09\x09\x09this.audio.pause();\n\x09\x09\x09this.audio.currentTime = this.audio.duration * (Pls.clickOffset(e) / this.offsetWidth);\n\x09\x09};\n\x09\x09var mouseleave = function(e) { this.mouseLeft = true; };\n\x09\x09var mouseenter = function(e) { this.mouseLeft = false; };\n\x09\x09var touchonly = function(f) {\n\x09\x09\x09return function(e) {\n\x09\x09\x09\x09e.preventDefault();\n\x09\x09\x09\x09f(e);\n\x09\x09\x09};\n\x09\x09};\n\n\x09\x09audio.track.addEventListener('touchstart', function(e) {\n\x09\x09\x09e.preventDefault();\n\x09\x09\x09e.stopPropagation();\n\x09\x09}, false);\n\n\x09\x09audio.track.addEventListener('mousemove',   mousemove,   false);\n\x09\x09audio.track.addEventListener('touchmove',   mousemove,   false);\n\x09\x09audio.track.addEventListener('mouseup',     mouseup,     false);\n\x09\x09audio.track.addEventListener('touchend',    mouseup,     false);\n\x09\x09audio.track.addEventListener('mouseleave',  mouseleave,  false);\n\x09\x09audio.track.addEventListener('touchleave',  mouseleave,  false);\n\x09\x09audio.track.addEventListener('mouseenter',  mouseenter,  false);\n\x09\x09audio.track.addEventListener('touchenter',  mouseenter,  false);\n\n\x09\x09audio.addEventListener('timeupdate', function(e) {\n\x09\x09\x09if (!this.track.dragging || this.track.mouseLeft) {\n\x09\x09\x09\x09this.track.bar.style.width = percent(this.currentTime, this.duration);\n\x09\x09\x09\x09this.song.currentTime.innerText = this.song.currentTime.textContent = formatDuration(this.currentTime) + '/';\n\x09\x09\x09}\n\x09\x09}, false);\n\n\x09\x09audio.addEventListener('playing', function() {\n\x09\x09\x09this.song.classList.remove('loading');\n\x09\x09\x09this.song.classList.add('active');\n\x09\x09\x09this.track.classList.add('active');\n\x09\x09\x09this.track.classList.remove('inactive');\n\x09\x09\x09if (that.vis != null) {\n\x09\x09\x09\x09that.vis.start();\n\x09\x09\x09}\n\x09\x09\x09this.song.setTitle('\xe2\x96\xb6');\n\x09\x09}, false);\n\n\x09\x09audio.addEventListener('pause', function() {\n\x09\x09\x09if (this.currentTime >= this.duration) {\n\x09\x09\x09\x09this.song.disable();\n\x09\x09\x09\x09this.song.next();\n\x09\x09\x09} else {\n\x09\x09\x09\x09this.song.classList.remove('active');\n\x09\x09\x09}\n\x09\x09\x09if (that.vis != null) {\n\x09\x09\x09\x09that.vis.stop();\n\x09\x09\x09}\n\x09\x09\x09this.song.setTitle('\xe2\x96\xa0');\n\x09\x09}, false);\n\n\x09\x09audio.addEventListener('progress', function(e) {\n\x09\x09\x09var j = this.buffered.length;\n\x09\x09\x09if (j < 1) {\n\x09\x09\x09\x09return;\n\x09\x09\x09}\n\x09\x09\x09var max = 0;\n\x09\x09\x09for (var i = 0; i < j; i++) {\n\x09\x09\x09\x09var end = this.buffered.end(i);\n\x09\x09\x09\x09if (end > max) {\n\x09\x09\x09\x09\x09max = end;\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\x09\x09\x09this.track.bufferBar.style.width = percent(end, this.duration);\n\x09\x09}, false);\n\n\x09\x09audio.addEventListener('readystatechange', function(e) {\n\x09\x09\x09console.log('readystatechange ' + this.readyState);\n\x09\x09\x09if (this.readyState < this.HAVE_ENOUGH_DATA && !this.paused) {\n\x09\x09\x09\x09this.song.classList.add('loading');\n\x09\x09\x09} else {\n\x09\x09\x09\x09this.song.classList.remove('loading');\n\x09\x09\x09}\n\x09\x09}, false);\n\n\x09\x09audio.hide    = function() { this.track.classList.remove('active'); };\n\x09\x09audio.disable = function() { this.track.classList.add('inactive'); };\n\x09\x09audio.enable  = function() { this.track.classList.remove('active'); };\n\x09},\n\n\x09hookSong: function(song) {\n\x09\x09var that = this;\n\n\x09\x09song.audio = song.querySelector('audio');\n\x09\x09song.totalTime = song.querySelector('.total-time');\n\x09\x09song.currentTime = song.querySelector('.current-time');\n\x09\x09song.deleteButton = song.querySelector('.delete-song');\n\n\x09\x09var setDuration = function() {\n\x09\x09\x09song.totalTime.textContent = song.totalTime.innerText = formatDuration(this.duration);\n\x09\x09};\n\n\x09\x09song.audio.addEventListener('durationchange', setDuration, false);\n\x09\x09song.audio.addEventListener('loadedmetadata', setDuration, false);\n\x09\x09if (song.audio.readyState >= HTMLAudioElement.HAVE_METADATA) {\n\x09\x09\x09setDuration.call(song.audio);\n\x09\x09}\n\n\x09\x09song.audio.song = song;\n\n\x09\x09Pls.hookAudio(song.audio);\n\n\x09\x09song.a = song.querySelector('a');\n\n\x09\x09song.stop = function() {\n\x09\x09\x09this.audio.pause();\n\x09\x09};\n\n\x09\x09song.disable = function() {\n\x09\x09\x09this.audio.track.classList.add('inactive');\n\x09\x09\x09this.audio.track.classList.remove('active');\n\x09\x09\x09this.classList.remove('active');\n\x09\x09};\n\n\x09\x09song.play = function(time) {\n\x09\x09\x09if (that.currentSong != null) {\n\x09\x09\x09\x09that.currentSong.stop();\n\x09\x09\x09\x09that.currentSong.disable();\n\x09\x09\x09}\n\n\x09\x09\x09if (history.state == null || history.state.id != this.dataset.id) {\n\x09\x09\x09\x09var href = this.a.getAttribute('href');\n\x09\x09\x09\x09if (window.location.hash != \"\") {\n\x09\x09\x09\x09\x09href += window.location.hash;\n\x09\x09\x09\x09}\n\x09\x09\x09\x09var state = { \"id\": this.dataset.id };\n\x09\x09\x09\x09var title = this.a.getAttribute('title');\n\x09\x09\x09\x09history.pushState(state, title, href);\n\x09\x09\x09}\n\n\x09\x09\x09that.currentSong = this;\n\x09\x09\x09this.classList.add('active');\n\n\x09\x09\x09if (that.haveAudioAPI) {\n\x09\x09\x09\x09if (this.mediaSource == null) {\n\x09\x09\x09\x09\x09this.mediaSource = that.ctx.createMediaElementSource(this.audio);\n\x09\x09\x09\x09}\n\x09\x09\x09\x09this.mediaSource.connect(that.analyser);\n\x09\x09\x09}\n\n\x09\x09\x09if (time != null) {\n\x09\x09\x09\x09var f = function() {\n\x09\x09\x09\x09\x09this.currentTime = time;\n\x09\x09\x09\x09\x09this.play();\n\x09\x09\x09\x09\x09this.removeEventListener('canplay', f);\n\x09\x09\x09\x09};\n\x09\x09\x09\x09this.audio.addEventListener('canplay', f, false);\n\n\x09\x09\x09\x09if (this.audio.readyState >= this.audio.HAVE_ENOUGH_DATA) {\n\x09\x09\x09\x09\x09this.audio.currentTime = time;\n\x09\x09\x09\x09\x09this.audio.removeEventListener('canplay', f);\n\x09\x09\x09\x09\x09this.audio.play();\n\x09\x09\x09\x09}\n\x09\x09\x09} else {\n\x09\x09\x09\x09this.audio.play();\n\x09\x09\x09}\n\x09\x09};\n\n\x09\x09song.toggle = function() {\n\x09\x09\x09if (!this.audio.paused) {\n\x09\x09\x09\x09this.stop();\n\x09\x09\x09} else {\n\x09\x09\x09\x09if (this.audio.readyState == HTMLMediaElement.HAVE_NOTHING) {\n\x09\x09\x09\x09\x09this.audio.load();\n\x09\x09\x09\x09}\n\x09\x09\x09\x09this.play();\n\x09\x09\x09}\n\x09\x09};\n\n\x09\x09song.prev = function() {\n\x09\x09\x09var prevSong = this.previousElementSibling;\n\x09\x09\x09if (prevSong != null) {\n\x09\x09\x09\x09prevSong.play();\n\x09\x09\x09}\n\x09\x09};\n\n\x09\x09song.next = function() {\n\x09\x09\x09var nextSong = this.nextElementSibling;\n\x09\x09\x09if (nextSong != null) {\n\x09\x09\x09\x09nextSong.play();\n\x09\x09\x09}\n\x09\x09};\n\n\x09\x09song.scrollTo = function() {\n\x09\x09\x09// TODO: animate it?\n\x09\x09\x09var y = this.offsetTop;\n\x09\x09\x09scroll(0, y - $('header').offsetHeight);\n\x09\x09};\n\n\x09\x09song.scrollToBottom = function() {\n\x09\x09\x09var y = this.offsetTop - window.innerHeight +\n\x09\x09\x09\x09this.offsetHeight + $('header').offsetHeight;\n\x09\x09\x09scroll(0, y);\n\x09\x09};\n\n\x09\x09song.remove = function() {\n\x09\x09\x09if (!confirm('Really delete \\'' + song.a.getAttribute('title') + '\\'?')) {\n\x09\x09\x09\x09return;\n\x09\x09\x09}\n\n\x09\x09\x09var x = new XMLHttpRequest();\n\n\x09\x09\x09x.addEventListener('load', function() {\n\x09\x09\x09\x09if (this.status !== 204) {\n\x09\x09\x09\x09\x09var err = JSON.parse(this.responseText);\n\x09\x09\x09\x09\x09that.showMessage($('#upload'), err.Error, 'bad');\n\x09\x09\x09\x09} else {\n\x09\x09\x09\x09\x09song.addEventListener('transitionend', function() {\n\x09\x09\x09\x09\x09\x09this.parentElement.removeChild(this);\n\x09\x09\x09\x09\x09}, false);\n\x09\x09\x09\x09\x09song.classList.add('fresh');\n\x09\x09\x09\x09\x09var trackCount = $('#track-count');\n\x09\x09\x09\x09\x09trackCount.innerText = trackCount.textContent = parseInt(trackCount.textContent || trackCount.innerText) - 1;\n\x09\x09\x09\x09}\n\x09\x09\x09}, false);\n\n\x09\x09\x09x.open('DELETE', '/file/' + this.dataset.id, true);\n\x09\x09\x09x.send();\n\x09\x09};\n\n\x09\x09song.setTitle = function(text) {\n\x09\x09\x09var h2 = this.a.querySelector('h2');\n\x09\x09\x09text = text + '\\uFE0E ' + (h2.innerText || h2.textContent);\n\x09\x09\x09var title = $('title');\n\x09\x09\x09title.innerText = title.textContent = text;\n\x09\x09};\n\n\n\x09\x09/*\n\x09\x09song.a.addEventListener('touchstart', function() {\n\x09\x09\x09e.stopPropagation();\n\x09\x09\x09e.preventDefault();\n\x09\x09}, false);\n\x09   */\n\n\x09\x09song.a.addEventListener('touchend', function(e) {\n\x09\x09\x09throw e;\n\x09\x09\x09if (song.dragged) {\n\x09\x09\x09\x09song.dragged = false;\n\x09\x09\x09\x09return;\n\x09\x09\x09}\n\x09\x09\x09e.stopPropagation();\n\x09\x09\x09e.preventDefault();\n\x09\x09\x09song.toggle();\n\x09\x09}, false);\n\n\x09\x09song.a.addEventListener('dragend', function(e) {\n\x09\x09\x09song.dragged = true;\n\x09\x09}, false);\n\n\x09\x09song.a.addEventListener('click', function(e) {\n\x09\x09\x09e.stopPropagation();\n\x09\x09\x09e.preventDefault();\n\x09\x09\x09song.toggle();\n\x09\x09}, false);\n\n\x09\x09song.deleteButton.addEventListener('click', function(e) {\n\x09\x09\x09e.stopPropagation();\n\x09\x09\x09e.preventDefault();\n\x09\x09\x09song.remove();\n\x09\x09}, false);\n\x09},\n\n\x09hookFollower: function(follower) {\n\x09\x09follower.addEventListener('transitionend', function(e) {\n\x09\x09\x09if (!e.target.classList.contains('active')) {\n\x09\x09\x09\x09e.target.style.display = 'none';\n\x09\x09\x09\x09this.loader.reset();\n\x09\x09\x09}\n\x09\x09}.bind(this));\n\n\x09\x09follower.show = function() {\n\x09\x09\x09this.style.display = 'block';\n\x09\x09\x09this.classList.add('active');\n\x09\x09};\n\x09\x09follower.hide = function() {\n\x09\x09\x09this.classList.remove('active');\n\x09\x09};\n\x09\x09follower.setPosEvent = function(e) {\n\x09\x09\x09this.setPos(e.clientX, e.clientY);\n\x09\x09};\n\x09\x09follower.setPos = function(x, y) {\n\x09\x09\x09this.style.left = (x - this.offsetWidth/2) + 'px';\n\x09\x09\x09this.style.top = (y - this.offsetHeight/2) + 'px';\n\x09\x09};\n\n\x09\x09this.loader = $('#loader');\n\x09\x09this.loader.bar = $('#loader-bar');\n\x09\x09this.loader.RADIUS = 96;\n\x09\x09this.loader.PATH_TEMPLATE = 'M' + (this.loader.RADIUS+4) + ' 4 a ' +\n\x09\x09\x09this.loader.RADIUS + ' ' + this.loader.RADIUS + ' 0 ';\n\n\x09\x09this.loader.setProgress = function(progress) {\n\x09\x09\x09var theta;\n\x09\x09\x09if (progress == 1) {\n\x09\x09\x09\x09theta = 2*Math.PI - 0.01;\n\x09\x09\x09} else {\n\x09\x09\x09\x09theta = 2*Math.PI * progress;\n\x09\x09\x09}\n\x09\x09\x09var x = Math.sin(theta) * this.RADIUS;\n\x09\x09\x09var y = -(Math.cos(theta) * this.RADIUS) + this.RADIUS;\n\x09\x09\x09var big = (theta >= Math.PI ? '1' : '0');\n\x09\x09\x09var d = this.PATH_TEMPLATE + big + ' 1 ' + x + ' ' + y;\n\x09\x09\x09if (progress == 1) {\n\x09\x09\x09\x09d += ' Z';\n\x09\x09\x09}\n\x09\x09\x09this.bar.setAttribute('d', d);\n\x09\x09};\n\n\x09\x09this.loader.reset = function() {\n\x09\x09\x09this.bar.setAttribute('d', '');\n\x09\x09};\n\x09},\n\n\x09getTrackList: function(cb) {\n\x09\x09json('/tracks.json', cb);\n\x09},\n\n\x09insertTrack: function(id, parent) {\n\x09\x09xhr(`/track/${id}.html`, null, function(x) {\n\x09\x09\x09\n\x09\x09});\n\x09},\n\n\x09merge: function(tracks) {\n\x09\x09diff(\n\x09\x09\x09Array.prototype.slice.call($$('li.songs')),\n\x09\x09\x09tracks,\n\x09\x09\x09function(song, track) {\n\x09\x09\x09\x09return song.dataset.id == track.id;\n\x09\x09\x09},\n\x09\x09\x09function(track) {\n\n\x09\x09\x09},\n\x09\x09\x09function(song) {\n\n\x09\x09\x09}\n\x09\x09);\n\x09}\n};\n"))
	bindata.RegisterFile(filepath.Join("static", "style.css"), time.Unix(1503457345, 0), []byte("* {\n\x09margin: 0;\n\x09padding: 0;\n\x09box-sizing: border-box;\n}\n\n*::selection {\n\x09background: #f00b42;\n\x09color: #fff;\n}\n\na {\n\x09text-decoration: none;\n}\n\nhtml {\n\x09min-height: 100%;\n\x09height: 100%;\n  -webkit-text-size-adjust: 100%;\n}\n\nbody {\n\x09font-family: 'rubik', 'clear sans', 'hiragino kaku gothic', meiryo, sans-serif;\n\x09background: #f8f8f8;\n\x09position: relative;\n\x09min-height: 100%;\n\x09overflow-x: hidden;\n}\n\n#shroud {\n\x09z-index: 200;\n\x09display: none;\n\x09position: fixed;\n\x09height: 100%;\n\x09width: 100%;\n\x09top: 0;\n\x09left: 0;\n}\n#shroud.active {\n\x09display: block;\n}\n\n#follower {\n\x09display: none;\n\x09z-index: 100;\n\x09position: fixed;\n\x09opacity: 0;\n\x09transform: scale(2);\n\x09-webkit-transform: scale(2);\n\x09transition-property: opacity, transform, -webkit-transform;\n\x09transition-duration: 0.5s;\n\x09transition-timing-function: cubic-bezier(0, 1, 0, 1);\n\x09width: 200px;\n\x09height: 200px;\n}\n#follower.active {\n\x09opacity: 1;\n\x09transform: scale(1);\n\x09-webkit-transform: scale(1);\n}\n\n#main {\n\x09max-width: 1024px;\n\x09margin: 0 auto 64px;\n\x09min-height: 100%;\n}\n\nheader {\n\x09height: 64px;\n\x09position: fixed;\n\x09top: 0;\n\x09width: 100%;\n\x09max-width: 1024px;\n\x09background: rgba(248, 248, 248, .9);\n\x09z-index: 50;\n}\nheader h1 a {\n\x09float: left;\n\x09padding: 0 16px;\n\x09color: #d91101;\n\x09display: inline-block;\n\x09height: 64px;\n\x09line-height: 64px;\n\x09font-size: 28px;\n  position: relative;\n}\nheader h1 a:hover {\n\x09background: #f00b42;\n\x09color: #fff;\n}\n#vis {\n\x09margin: 16px 0 0 -128px;\n\x09/*border-bottom: 2px solid #f00b42;*/\n\x09position: absolute;\n\x09left: 50%;\n\x09cursor: pointer;\n}\nbutton {\n\x09-webkit-appearance: none;\n\x09-moz-appearance: none;\n\x09appearance: none;\n\n\x09color: #d91101;\n\x09font-family: 'rubik', 'clear sans', 'hiragino kaku gothic', meiryo, sans-serif;\n\x09background: transparent;\n\x09border: 1px solid #f00b42;\n\x09outline: none;\n}\nbutton:hover {\n\x09color: #fff;\n\x09background: #f00b42;\n}\nbutton:active {\n\x09background: #f83801;\n}\n\n#upload {\n\x09padding: 0 16px;\n\x09height: 32px;\n\x09line-height: 32px;\n\x09margin: 16px;\n\x09float: right;\n\x09font-size: 14px;\n\x09border-radius: 16px;\n}\n\n.delete-song {\n  border: none;\n  position: absolute;\n  top: 8px;\n  right: 8px;\n\x09font-size: 24px;\n  color: #888;\n  z-index: 99;\n}\n\n.delete-song:hover {\n  color: #f00b42;\n  background: transparent;\n}\n\nh2 {\n  font-family: 'tinos', 'didot', 'georgia', 'hiragino mincho pro', 'ryo text plusn', serif;\n\x09font-size: 28px;\n\x09font-weight: 400;\n  line-height: 1;\n  margin-bottom: 8px;\n}\nh3 {\n  /* text-transform: uppercase; */\n\x09font-size: 14px;\n\x09color: #888;\n  font-weight: 400;\n}\nh3 span {\n  font-weight: 700;\n}\nh3 time {\n\x09/* font-weight: 400; */\n}\n#loader {\n\x09position: relative;\n\x09width: 200px;\n\x09height: 200px;\n}\n#loader-bg {\n\x09z-index: 101;\n\x09fill: rgba(217, 17, 1, .2);\n}\n#loader-track {\n\x09z-index: 102;\n\x09fill: none;\n\x09stroke-width: 8;\n\x09stroke: rgba(217, 17, 1, .1);\n}\n#loader-bar {\n\x09stroke-width: 8;\n\x09fill: transparent;\n\x09stroke: #f00b42;\n}\n.song a {\n\x09color: #000;\n\x09display: block;\n\x09padding: 24px 160px 24px 16px;\n\x09min-height: 95px;\n  position: relative;\n}\n.song a:hover {\n\x09color: #f00b42;\n}\n.meta {\n\x09font-size: 14px;\n\x09color: #888;\n\x09position: absolute;\n\x09top: 0;\n\x09right: 0;\n\x09text-align: right;\n\x09padding: 16px;\n  height: 100%;\n}\n.meta .duration {\n\x09font-size: 18px;\n  line-height: 1;\n  position: absolute;\n  bottom: 22px;\n  right: 16px;\n  width: 100px;\n}\n\n#songlist {\n\x09margin-top: 64px;\n\x09list-style-type: none;\n}\n\nli.song {\n\x09position: relative;\n\x09margin-bottom: 16px;\n\x09overflow: hidden;\n\x09max-height: 200px;\n\x09transition: max-height 0.5s cubic-bezier(0, .8, 1, .2);\n}\nli.song.fresh {\n\x09max-height: 0;\n\x09transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\n}\n\nli.song.active {\n\x09background: #fff;\n}\nli.song.active h2 {\n\x09color: #d91101;\n}\n\n.player-track {\n\x09position: relative;\n\x09transition: all .5s cubic-bezier(0, 1, 0, 1);\n\x09/*display: none;*/\n\x09height: 0px;\n\x09background: #dfdfdf;\n\x09z-index: 5;\n}\n.player-track.inactive {\n\x09height: 3px;\n}\n.player-track.active {\n\x09height: 16px;\n}\n.player-track .player-bar {\n\x09height: 100%;\n\x09width: 0%;\n\x09position: absolute;\n\x09left: 0;\n\x09top: 0;\n}\n.playback-bar {\n\x09border-right: 2px solid #a00;\n\x09background: #d91101;\n\x09z-index: 4;\n}\n.buffer-bar {\n\x09border-right: 2px solid #bbb;\n\x09background: #d0d0d0;\n\x09z-index: 3;\n}\n\n.song.loading .buffer-bar {\n\x09display: none;\n}\n\n.song.loading .player-track.active {\n\x09background: repeating-linear-gradient(135deg, #ccc, #ccc 20px, #ddd 20px, #ddd 40px);\n\x09animation-duration: 0.5s;\n\x09animation-name: scrolling-bar;\n\x09animation-iteration-count: infinite;\n\x09animation-timing-function: linear;\n}\n\n@keyframes scrolling-bar {\n\x09from {\n\x09\x09background-position: 0 0;\n\x09}\n\n\x09to {\n\x09\x09background-position: 56.5px 0;\n\x09}\n}\n\n/* Needed to insert text as HTML without ruining all of the event listeners. */\n.hidden {\n\x09visibility: hidden;\n\x09overflow: hidden;\n\x09width: 0;\n\x09height: 0;\n}\n\nfooter {\n\x09padding: 16px;\n\x09color: #888;\n\x09text-align: center;\n}\n\n@media screen and (max-width: 1024px) {\n  .delete-song {\n    right: 16px;\n    font-size: 22px;\n  }\n}\n\n@media screen and (max-width: 540px) {\n\x09h2 {\n\x09\x09font-size: 20px;\n\x09}\n  h3 {\n    font-size: 14px;\n  }\n\x09.meta {\n\x09\x09position: relative;\n\x09\x09text-align: left;\n\x09\x09padding: 0;\n\x09}\n\x09.meta .duration, .sizedate {\n\x09\x09font-size: 14px;\n\x09\x09display: inline-block;\n    line-height: 1.5;\n    position: relative;\n    bottom: 0;\n    right: 0;\n\x09}\n\x09.delete-song {\n\x09\x09/* float: right; */\n    bottom: 0;\n    right: 16px;\n    top: 0;\n    font-size: 18px;\n    line-height: 18px;\n\x09}\n  .song {\n    padding-right: 32px;\n  }\n\x09.song a {\n\x09\x09padding: 16px;\n\x09}\n\x09#vis {\n\x09\x09display: none;\n\x09}\n}\n"))
	bindata.RegisterFile(filepath.Join("static", "vis.pls.js"), time.Unix(1509834547, 0), []byte("function Visual(elem, analyser, stopSpeed, numBars) {\n\x09this.elem = elem;\n\x09this.mode = Visual.STOPPED;\n\x09this.stopSpeed = stopSpeed;\n\n\x09this.analyser = analyser;\n\x09this.analyser.maxDecibels = -15;\n\x09this.numBars = numBars;\n\x09this.analyser.fftSize = this.numBars * 2;\n\x09var len = this.analyser.frequencyBinCount;\n\x09this.freqs = new Uint8Array(len);\n\x09this.barWidth = this.elem.width / len;\n\n\x09this.ctx = this.elem.getContext('2d');\n\x09this.ctx.fillStyle = this.ctx.strokeStyle = '#f00b42';\n\x09this.ctx.lineWidth = 2;\n\n\x09this.scaleCanvas(this.ctx);\n\n\x09this.samples = new Uint8Array(this.elem.width);\n\x09this.scaleFactors = new Float32Array(this.elem.width);\n\x09for (var i = 0, l = this.scaleFactors.length; i < l; i++) {\n\x09\x09this.scaleFactors[i] = Math.sin(Math.PI * i / l);\n\x09}\n\n\x09this.buf = new CircularBuffer(this.elem.width / 2);\n\x09for (var i = 0; i < this.buf.arr.length; i++) {\n\x09\x09this.buf.arr[i] = new Uint8Array(this.elem.height);\n\x09}\n\n\x09this.currentStyle = parseInt(window.cookies['style'] || 0);\n\n\x09var that = this;\n\n\x09this.elem.addEventListener('click', function(e) {\n\x09\x09that.currentStyle = (that.currentStyle + 1) % Visual.styles.length;\n\x09\x09document.cookie = 'style=' + that.currentStyle;\n\x09}, false);\n}\n\nvisual.prototype.scaleCanvas = function(ctx) {\n\x09var devicePixelRatio = window.devicePixelRatio || 1;\n\x09var width = ctx.canvas.clientWidth * devicePixelRatio;\n\x09var height = ctx.canvas.clientHeight * devicePixelRatio;\n\x09if (width !== ctx.canvas.width || height !== ctx.canvas.height) {\n\x09\x09ctx.canvas.width = width;\n\x09\x09ctx.canvas.height = height;\n\x09\x09ctx.scale(0, 0, ctx.canvas.width, ctx.canvas.height);\n\x09}\n};\n\n\nVisual.STOPPED  = 0;\nVisual.STOPPING = 1;\nVisual.RUNNING  = 2;\nVisual.INIT     = 3;\n\nVisual.prototype.start = function() {\n\x09if (this.mode == Visual.STOPPED) {\n\x09\x09this.mode = Visual.RUNNING;\n\x09\x09requestAnimationFrame(this.draw.bind(this));\n\x09} else {\n\x09\x09this.mode = Visual.RUNNING;\n\x09}\n};\n\nVisual.prototype.stop = function() {\n\x09this.mode = Visual.STOPPING;\n};\n\nVisual.prototype.draw = function() {\n\x09var t = Visual.styles[this.currentStyle].call(this);\n\x09//if (t == null) {\n\x09\x09requestAnimationFrame(this.draw.bind(this));\n\x09//} else {\n\x09\x09//setTimeout(this.draw.bind(this), t);\n\x09//}\n};\n\nVisual.styles = [\n\x09function() {\n\x09\x09this.analyser.fftSize = this.numBars * 2;\n\x09\x09this.ctx.fillStyle = '#f00b42';\n\n\x09\x09switch (this.mode) {\n\x09\x09case Visual.RUNNING:\n\x09\x09\x09this.analyser.getByteFrequencyData(this.freqs);\n\x09\x09\x09break;\n\n\x09\x09case Visual.STOPPING:\n\x09\x09\x09var gotOne = false;\n\n\x09\x09\x09for (var i = 0; i < this.freqs.length; i++) {\n\x09\x09\x09\x09if (this.freqs[i] > 0) {\n\x09\x09\x09\x09\x09gotOne = true;\n\x09\x09\x09\x09\x09if (this.freqs[i] >= this.stopSpeed) {\n\x09\x09\x09\x09\x09\x09this.freqs[i] -= this.stopSpeed;\n\x09\x09\x09\x09\x09} else {\n\x09\x09\x09\x09\x09\x09this.freqs[i] = 0;\n\x09\x09\x09\x09\x09}\n\x09\x09\x09\x09}\n\x09\x09\x09}\n\n\x09\x09\x09if (gotOne) {\n\x09\x09\x09\x09break;\n\x09\x09\x09}\n\x09\x09\x09this.mode = Visual.STOPPED;\n\n\x09\x09case Visual.STOPPED:\n\x09\x09\x09this.ctx.clearRect(0, 0, this.elem.width, this.elem.height);\n\x09\x09\x09return;\n\x09\x09}\n\n\x09\x09this.ctx.clearRect(0, 0, this.elem.width, this.elem.height);\n\x09\x09var h = this.elem.height;\n\x09\x09var x, dy, y1;\n\x09\x09var y = h / 2;\n\n\x09\x09for (var i = 0; i < this.freqs.length; i++) {\n\x09\x09\x09x = i * this.barWidth;\n\x09\x09\x09dy = (this.freqs[i]/255) * h;\n\x09\x09\x09y1 = y - dy/2;\n\n\x09\x09\x09this.ctx.fillRect(x, y1, this.barWidth - 1, dy);\n\x09\x09}\n\x09},\n\n\x09function() {\n\x09\x09this.analyser.fftSize = this.elem.width;\n\n\x09\x09switch (this.mode) {\n\x09\x09case Visual.RUNNING:\n\x09\x09\x09this.analyser.getByteTimeDomainData(this.samples);\n\x09\x09\x09break;\n\n\x09\x09case Visual.STOPPING:\n\x09\x09\x09this.mode = Visual.STOPPED;\n\n\x09\x09case Visual.STOPPED:\n\x09\x09\x09this.ctx.clearRect(0, 0, this.elem.width, this.elem.height);\n\x09\x09\x09this.ctx.beginPath();\n\x09\x09\x09this.ctx.moveTo(0, this.elem.height/2);\n\x09\x09\x09this.ctx.lineTo(this.elem.width, this.elem.height/2);\n\x09\x09\x09this.ctx.stroke();\n\x09\x09\x09return;\n\x09\x09}\n\n\x09\x09this.ctx.clearRect(0, 0, this.elem.width, this.elem.height);\n\x09\x09this.ctx.beginPath();\n\x09\x09var h = this.elem.height;\n\x09\x09var x, y;\n\n\x09\x09for (var i = 0; i < this.samples.length; i++) {\n\x09\x09\x09x = i;\n\x09\x09\x09y = (this.samples[i] / 255);\n\x09\x09\x09y -= 0.5;\n\x09\x09\x09y *= this.scaleFactors[i];\n\x09\x09\x09y += 0.5;\n\x09\x09\x09y *= h;\n\n\x09\x09\x09if (i == 0) {\n\x09\x09\x09\x09this.ctx.moveTo(x, y);\n\x09\x09\x09} else {\n\x09\x09\x09\x09this.ctx.lineTo(x, y);\n\x09\x09\x09}\n\x09\x09}\n\n\x09\x09this.ctx.stroke();\n\x09},\n\n\x09function() {\n\x09\x09this.analyser.fftSize = this.elem.height * 2;\n\n\x09\x09switch (this.mode) {\n\x09\x09case Visual.RUNNING:\n\x09\x09\x09this.analyser.getByteFrequencyData(this.buf.arr[this.buf.i]);\n\x09\x09\x09this.buf.advance();\n\x09\x09\x09break;\n\n\x09\x09case Visual.STOPPING:\n\x09\x09\x09this.mode = Visual.STOPPED;\n\n\x09\x09case Visual.STOPPED:\n\x09\x09\x09return;\n\x09\x09}\n\n\x09\x09this.ctx.clearRect(0, 0, this.elem.width, this.elem.height);\n\x09\x09var y, z;\n\n\x09\x09this.buf.each(function(row, i) {\n\x09\x09\x09if (row == null) {\n\x09\x09\x09\x09return;\n\x09\x09\x09}\n\x09\x09\x09for (var j = 0; j < row.length; j++) {\n\x09\x09\x09\x09y = this.elem.height - j;\n\x09\x09\x09\x09z = 'rgba(240, 11, 66, ' + (this.scaleFactors[i]*row[j]/255) + ')'\n\n\x09\x09\x09\x09this.ctx.fillStyle = z;\n\x09\x09\x09\x09this.ctx.fillRect(i, y, 1, 1);\n\x09\x09\x09\x09this.ctx.fillRect(this.elem.width - i - 1, y, 1, 1);\n\x09\x09\x09}\n\x09\x09}.bind(this));\n\x09}\n];\n\nfunction CircularBuffer(size) {\n\x09if (size == 0) {\n\x09\x09throw new Error('CircularBuffer: cannot create empty buffer');\n\x09}\n\x09this.arr = new Array(size);\n\x09this.i = 0;\n}\n\nCircularBuffer.prototype.advance = function() {\n\x09this.i = (this.i + 1) % this.arr.length;\n\x09return this.i;\n};\n\nCircularBuffer.prototype.add = function(elem) {\n\x09this.arr[this.advance()] = elem;\n};\n\nCircularBuffer.prototype.each = function(f) {\n\x09for (var i = 0; i < this.arr.length; i++) {\n\x09\x09f(this.arr[this.i], i);\n\x09\x09this.advance();\n\x09}\n};\n"))
}
